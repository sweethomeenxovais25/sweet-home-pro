if not df_fin.empty:
                # ğŸ’¡ A MÃGICA: Busca pelo NOME do cabeÃ§alho que vocÃª me passou, nÃ£o pela posiÃ§Ã£o!
                df_fin['VALOR_NUM'] = df_fin['TOTAL R$'].apply(limpar_v)
                df_fin['FORMA_PG'] = df_fin['FORMA DE PAGAMENTO']
                df_fin['SALDO_NUM'] = df_fin['SALDO DEVEDOR'].apply(limpar_v)
                
                # Para o lucro, vamos garantir que ele ache a coluna certa tambÃ©m
                if 'LUCRO' in df_fin.columns:
                    df_fin['LUCRO_NUM'] = df_fin['LUCRO'].apply(limpar_v)
                elif 'LUCRO R$' in df_fin.columns:
                    df_fin['LUCRO_NUM'] = df_fin['LUCRO R$'].apply(limpar_v)
                else:
                    df_fin['LUCRO_NUM'] = df_fin.iloc[:, 12].apply(limpar_v) # Fallback
                
                vendas_brutas = df_fin['VALOR_NUM'].sum()
                lucro_bruto = df_fin['LUCRO_NUM'].sum()
                saldo_devedor = df_fin['SALDO_NUM'].sum()
                total_recebido = vendas_brutas - saldo_devedor
                
                # CÃ¡lculo de Liquidez
                receita_imediata = df_fin[df_fin['FORMA_PG'] != 'Sweet Flex']['VALOR_NUM'].sum()
                indice_liquidez = (receita_imediata / vendas_brutas * 100) if vendas_brutas > 0 else 0
            else:
                vendas_brutas = lucro_bruto = saldo_devedor = total_recebido = indice_liquidez = 0.0
            
            # 2. MÃ‰TRICAS PRINCIPAIS (AGORA SÃ“ COM VENDAS REAIS)
            c1, c2, c3, c4 = st.columns(4)
            c1.metric("Vendas Totais", f"R$ {vendas_brutas:,.2f}", help="Soma de todas as vendas reais registradas para clientes (jÃ¡ excluindo as retiradas dos sÃ³cios).")
            c2.metric("Lucro Bruto", f"R$ {lucro_bruto:,.2f}", help="Lucro projetado dessas vendas (Valor Total de Venda cobrado menos o Custo de FÃ¡brica dos produtos).")
            c3.metric("Total Recebido", f"R$ {total_recebido:,.2f}", delta="Dinheiro em Caixa", help="Capital que jÃ¡ entrou de fato no caixa da loja (Pix, Dinheiro, CartÃ£o ou parcelas do Flex que jÃ¡ foram pagas).")
            c4.metric("Saldo Devedor", f"R$ {saldo_devedor:,.2f}", delta=f"{(saldo_devedor/vendas_brutas*100):.1f}% pendente" if vendas_brutas > 0 else "0%", delta_color="inverse", help="Montante que estÃ¡ 'na rua', aguardando o pagamento das faturas em aberto pelas clientes.")
